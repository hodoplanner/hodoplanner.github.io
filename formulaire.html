<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Devis automatique — HodoPlanner</title>

<link rel="icon" href="images/favicon.png" type="image/png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
  :root{
    --accent:#7e8db0;
    --text:#0f172a;
    --muted:#5b6476;
    --bg:#f7f9fc;
    --card:#ffffff;
    --radius:16px;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    background:var(--bg); color:var(--text);
  }

  /* Header */
  header{
    background:#fff; border-bottom:1px solid #e9eef6;
    padding:12px 16px; display:flex; align-items:center; gap:10px;
    position:sticky; top:0; z-index:20;
  }
  header img{width:32px; height:32px}
  header b{font-size:18px}
  header .spacer{flex:1}
  header a.back{color:var(--muted); text-decoration:none; font-weight:700}
  header a.back:hover{color:#111}

  /* Layout */
  .wrap{max-width:900px; margin:0 auto; padding:22px 16px 48px;}
  h1{font-size:28px; margin:0 0 10px}
  .muted{color:var(--muted)}
  .note{
    margin:16px 0; padding:12px 14px; border-radius:12px;
    background:#fff6f2; color:#7a3b26; border:1px solid #ffe4d6; font-weight:600;
  }

  /* Form */
  form{display:grid; gap:16px}
  label{font-weight:700; font-size:14px; color:#334155}
  input, select, textarea{
    width:100%; border:1px solid #dbe3ee; background:#fff; color:var(--text);
    border-radius:12px; padding:12px; font-size:14px; outline:none;
  }
  textarea{min-height:110px; resize:vertical}

  .grid-2{display:grid; gap:14px}
  @media(min-width:720px){ .grid-2{grid-template-columns:1fr 1fr} }

  .btn{
    display:inline-flex; align-items:center; gap:10px; height:46px;
    padding:0 16px; border-radius:12px; border:1px solid transparent;
    cursor:pointer; text-decoration:none; font-weight:800; font-size:15px;
  }
  .btn.primary{background:var(--accent); color:#fff}
  .btn.primary:hover{filter:brightness(.97)}
  .btn.ghost{background:#fff; border-color:#e6ecf4; color:#374151}

  .panel{
    margin-top:18px; background:#fff; border:1px solid #e9eef6; border-radius:var(--radius);
    box-shadow:0 14px 30px rgba(15,23,42,.06); padding:18px;
  }
  .est-total{font-size:22px; font-weight:900; margin:6px 0 2px}
  .cross{ text-decoration: line-through; opacity:.6; }
  .ok{ color:#16a34a; font-weight:800 }
  .small{font-size:13px; color:var(--muted)}
  .row{display:flex; gap:10px; flex-wrap:wrap; align-items:center}

  .pill{
    display:inline-flex; gap:6px; align-items:center;
    background:#eef3fb; color:#2f3e64; border:1px solid #dde7f6;
    border-radius:999px; padding:6px 10px; font-weight:700; font-size:12px;
  }
</style>
</head>
<body>

<header>
  <img src="images/erika-logo.png" alt="logo">
  <b>HodoPlanner</b>
  <div class="spacer"></div>
  <a class="back" href="index.html"><i class="fa-solid fa-arrow-left"></i> Retour au site</a>
</header>

<div class="wrap">
  <h1>Devis automatique</h1>
  <p class="muted">
    Entre tes infos de voyage. Je calcule une <b>estimation de prix public</b> pour la planification.<br>
    En ce moment : <b>offre lancement — gratuit contre un avis</b> ⭐
  </p>
  <div class="note"><i class="fa-solid fa-circle-info"></i> L’estimation dépend du budget total, de la durée et du nombre de voyageurs.</div>

  <div class="panel">
    <h2 style="margin:0 0 6px">Demander un devis</h2>
    <p class="small" style="margin:0 0 12px">Remplis ce formulaire pour obtenir une estimation automatique. À la fin, tu pourras m’envoyer tes infos si tu veux aller plus loin.</p>

    <!-- FORMULAIRE -->
    <form id="quoteForm" novalidate>
      <div class="grid-2">
        <div>
          <label>Prénom</label>
          <input name="firstname" required />
        </div>
        <div>
          <label>Email</label>
          <input type="email" name="email" required />
        </div>
      </div>

      <div>
        <label>Destination(s)</label>
        <input name="destinations" placeholder="ex. Japon, Corée…" required />
      </div>

      <div class="grid-2">
        <div>
          <label>Date de début</label>
          <input type="date" name="start" required />
        </div>
        <div>
          <label>Date de fin</label>
          <input type="date" name="end" required />
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label>Nombre de voyageurs</label>
          <input type="number" name="people" min="1" value="1" required />
        </div>
        <div>
          <label>Style de voyage</label>
          <select name="style">
            <option value="">Choisis…</option>
            <option>Aventure</option>
            <option>Culture</option>
            <option>Relax / balnéaire</option>
            <option>Mix équilibré</option>
          </select>
        </div>
      </div>

      <div class="grid-2">
        <div>
          <label>Budget avion (par personne) €</label>
          <input type="number" name="budget_flight" min="0" step="10" placeholder="ex. 800" required />
        </div>
        <div>
          <label>Budget hébergement (total) €</label>
          <input type="number" name="budget_hotel" min="0" step="10" placeholder="ex. 800" required />
        </div>
      </div>

      <div>
        <label>Budget activités & extras (total) €</label>
        <input type="number" name="budget_activities" min="0" step="10" placeholder="ex. 500" required />
      </div>

      <div class="grid-2">
        <div>
          <label>Complexité</label>
          <select name="complexity">
            <option value="normal">Classique (1–3 villes)</option>
            <option value="multi">Multi-villes (4+)</option>
            <option value="multi_countries">Multi-pays</option>
          </select>
        </div>
        <div>
          <label>Accompagnement</label>
          <select name="support">
            <option value="standard">Standard (préparation)</option>
            <option value="plus">+ Rappels de réservations (HodoReminder)</option>
            <option value="premium">+ Dispo pendant le voyage</option>
          </select>
        </div>
      </div>

      <label class="small" style="display:flex;gap:8px;align-items:flex-start;margin:6px 0 10px">
        <input type="checkbox" id="agreeTC" style="margin-top:4px">
        <span>J’ai lu et j’accepte les <a href="conditions.html" target="_blank">Conditions de service</a>.</span>
      </label>

      <div class="row">
        <button type="button" class="btn primary" id="btnCalc">
          <i class="fa-solid fa-calculator"></i> Calculer l’estimation
        </button>
        <a class="btn ghost" href="index.html"><i class="fa-solid fa-arrow-left"></i> Retour</a>
      </div>
    </form>

    <!-- RÉSULTAT -->
    <div id="result" class="panel" style="display:none">
      <div class="row" style="justify-content:space-between; width:100%">
        <div>
          <div class="pill"><i class="fa-solid fa-receipt"></i> Estimation de prix public</div>
          <div class="est-total" id="estRange"></div>
          <div class="small" id="estExplain"></div>
        </div>
        <div style="text-align:right">
          <div class="small cross" id="publicCross"></div>
          <div class="ok"><i class="fa-solid fa-gift"></i> Offre lancement : <b>GRATUIT</b> ⭐</div>
          <div class="small">contre un avis après réalisation</div>
        </div>
      </div>

      <hr style="border:none; border-top:1px solid #e9eef6; margin:16px 0">

      <div class="row">
        <button class="btn primary" id="btnSend" disabled>
          <i class="fa-solid fa-paper-plane"></i> Envoyer ma demande
        </button>
        <span class="small">Tu recevras une proposition précise sous 24h.</span>
      </div>
    </div>
  </div>
</div>

<script>
  // Helpers
  const round10 = v => Math.round(v/10)*10;
  const daysBetween = (d1, d2) => {
    const a = new Date(d1), b = new Date(d2);
    const ms = b - a;
    return Math.max(0, Math.round(ms / 86400000));
  };

  // Elements
  const form = document.getElementById('quoteForm');
  const btnCalc = document.getElementById('btnCalc');
  const result = document.getElementById('result');
  const estRange = document.getElementById('estRange');
  const estExplain = document.getElementById('estExplain');
  const publicCross = document.getElementById('publicCross');
  const agreeTC = document.getElementById('agreeTC');
  const btnSend = document.getElementById('btnSend');

  // Core pricing
  function computeQuote({flightPP=0, hotel=0, activities=0, people=1, days=0, complexity='normal', support='standard'}){
    const totalBudget = (flightPP||0) * (people||1) + (hotel||0) + (activities||0);

    // % de base en fonction du budget total
    let pctLow=0.10, pctHigh=0.14;
    if (totalBudget < 1500){ pctLow=0.08; pctHigh=0.10; }
    else if (totalBudget <= 4000){ pctLow=0.10; pctHigh=0.14; }
    else if (totalBudget <= 8000){ pctLow=0.11; pctHigh=0.15; }
    else { pctLow=0.12; pctHigh=0.16; }

    // Ajustement durée (au-delà de 7 jours, +0.2%/jour, max +2%)
    const extraDays = Math.max(0, (days||0) - 7);
    const durAdj = Math.min(0.02, extraDays * 0.002);
    pctLow += durAdj; pctHigh += durAdj;

    // Ajustement voyageurs (>4 => +1%)
    if ((people||1) > 4){ pctLow += 0.01; pctHigh += 0.01; }

    // Complexité
    if (complexity === 'multi'){ pctLow += 0.005; pctHigh += 0.01; }
    if (complexity === 'multi_countries'){ pctLow += 0.01; pctHigh += 0.02; }

    // Support
    if (support === 'plus'){ pctLow += 0.005; pctHigh += 0.01; }
    if (support === 'premium'){ pctLow += 0.015; pctHigh += 0.025; }

    // Base fixe pour très petits budgets
    const baseFee = totalBudget < 1500 ? 40 : 0;

    const estLow = round10(baseFee + totalBudget * pctLow);
    const estHigh = round10(baseFee + totalBudget * pctHigh);

    return { totalBudget, estLow, estHigh, pctLow, pctHigh };
  }

  // Calcul
  btnCalc.addEventListener('click', () => {
    const data = new FormData(form);
    const start = data.get('start'), end = data.get('end');
    const days = daysBetween(start, end) || 0;
    const people = parseInt(data.get('people')||'1',10);

    const flightPP = parseFloat(data.get('budget_flight')||'0');
    const hotel = parseFloat(data.get('budget_hotel')||'0');
    const activities = parseFloat(data.get('budget_activities')||'0');

    const {estLow, estHigh, totalBudget, pctLow, pctHigh} = computeQuote({
      flightPP, hotel, activities, people, days,
      complexity: data.get('complexity')||'normal',
      support: data.get('support')||'standard'
    });

    estRange.textContent = `${estLow.toLocaleString('fr-FR')}€ – ${estHigh.toLocaleString('fr-FR')}€`;
    estExplain.textContent = `Basé sur un budget total ≈ ${Math.round(totalBudget).toLocaleString('fr-FR')}€ pour ${days || 'N/A'} jours, ${(pctLow*100).toFixed(1)}–${(pctHigh*100).toFixed(1)}% + ajustements.`;
    publicCross.textContent = `Prix public estimé : ${estLow.toLocaleString('fr-FR')}–${estHigh.toLocaleString('fr-FR')} €`;

    result.style.display = 'block';
    result.scrollIntoView({behavior:'smooth', block:'start'});
  });

  // Activer l’envoi si conditions acceptées
  document.addEventListener('change', () => {
    if(agreeTC) btnSend.disabled = !agreeTC.checked;
  });

  // Envoi (Formspree)
  btnSend.addEventListener('click', async (e) => {
    e.preventDefault();
    if(!agreeTC.checked){
      alert("Merci d’accepter les conditions avant d’envoyer.");
      return;
    }

    const data = new FormData(form);
    const payload = new FormData();
    for (const [k,v] of data.entries()) payload.append(k, v);
    payload.append('estimation', estRange.textContent);

    try{
      const r = await fetch('https://formspree.io/f/your-id', {
        method: 'POST',
        headers: { 'Accept': 'application/json' },
        body: payload
      });
      if(r.ok){
        alert("Merci ! Ta demande a été envoyée. Réponse sous 24h ✈️");
        form.reset();
        btnSend.disabled = true;
      }else{
        alert("Oups, envoi impossible. Tu peux m’écrire à hello@erikaramel.com");
      }
    }catch{
      alert("Oups, envoi impossible. Tu peux m’écrire à hello@erikaramel.com");
    }
  });
</script>

</body>
</html>