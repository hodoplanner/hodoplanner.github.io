<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Devis automatique ‚Äî HodoPlanner</title>

<link rel="icon" href="images/favicon.png" type="image/png" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<style>
  /* ---------- Brand / theme ---------- */
  :root{
    --accent:#7e8db0;
    --text:#0f172a;
    --muted:#5b6476;
    --card:#ffffff;
    --radius:16px;
  }

  /* Noyh A pour les titres seulement */
  @font-face{
    font-family:'NoyhA';
    src:url('font/NoyhA-Regular.ttf') format('truetype');
    font-weight:700;
    font-style:normal;
    font-display:swap;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial;
    /* Fond nuages (mobile par d√©faut) */
    background: #f3f6fb url('images/nuages-mobile.png') center top / 900px auto repeat;
  }
  @media (min-width: 960px){
    body{ background: #f3f6fb url('images/nuages-pc.png') center top / 1200px auto repeat; }
  }

  h1,h2,h3{ font-family:'NoyhA', system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial; }

  /* ---------- Header ---------- */
  header{
    position:sticky; top:0; z-index:20;
    background:rgba(255,255,255,.92); backdrop-filter: blur(8px);
    border-bottom:1px solid #e9eef6;
  }
  .bar{
    max-width:960px; margin:0 auto; padding:12px 16px;
    display:flex; align-items:center; gap:12px;
  }
  header img{width:28px; height:28px; object-fit:contain}
  header b{font-size:18px}
  .bar .spacer{flex:1}
  header a.back{color:#334155; text-decoration:none; font-weight:800; white-space:nowrap}
  header a.back i{margin-right:8px}

  /* ---------- Layout ---------- */
  .wrap{max-width:960px; margin:0 auto; padding:22px 16px 48px;}
  h1{font-size:34px; margin:0 0 8px}
  .muted{color:var(--muted)}
  .note{
    margin:16px 0; padding:12px 14px; border-radius:12px;
    background:#fff6f2; color:#7a3b26; border:1px solid #ffe4d6; font-weight:700;
  }

  /* ---------- Card / panel ---------- */
  .panel{
    margin-top:18px; background:#fff; border:1px solid #e9eef6; border-radius:var(--radius);
    box-shadow:0 14px 30px rgba(15,23,42,.06); padding:18px;
  }

  /* ---------- Form ---------- */
  form{display:grid; gap:16px}
  label{font-weight:800; font-size:14px; color:#334155}
  input, select, textarea{
    width:100%; border:1px solid #dbe3ee; background:#fff; color:var(--text);
    border-radius:12px; padding:12px; font-size:15px; outline:none;
  }
  textarea{min-height:110px; resize:vertical}

  .grid-2{display:grid; gap:14px}
  @media(min-width:720px){ .grid-2{grid-template-columns:1fr 1fr} }

  .btn{
    display:inline-flex; align-items:center; gap:10px; height:46px;
    padding:0 18px; border-radius:12px; border:1px solid transparent;
    cursor:pointer; text-decoration:none; font-weight:900; font-size:15px;
  }
  .btn.primary{background:var(--accent); color:#fff}
  .btn.primary:hover{filter:brightness(.97)}
  .btn.ghost{background:#fff; border-color:#e6ecf4; color:#374151}

  .small{font-size:13px; color:var(--muted)}
  .row{display:flex; gap:12px; flex-wrap:wrap; align-items:center}

  .pill{
    display:inline-flex; gap:6px; align-items:center;
    background:#eef3fb; color:#2f3e64; border:1px solid #dde7f6;
    border-radius:999px; padding:6px 10px; font-weight:800; font-size:12px;
  }
  .est-total{font-size:26px; font-weight:900; margin:6px 0 2px}
  .ok{ color:#16a34a; font-weight:800 }
  .cross{ text-decoration: line-through; opacity:.6; }

  /* Conditions + actions */
  .actions{ display:flex; gap:12px; align-items:center; flex-wrap:wrap; }
  .tc{
    display:flex; align-items:center; gap:10px;
    background:#fff; border:1px solid #e6ecf4; padding:10px 12px; border-radius:12px;
  }
  .tc input{width:18px; height:18px}
</style>
</head>

<body>
  <header>
    <div class="bar">
      <img src="images/favicon.png" alt="logo">
      <b>HodoPlanner</b>
      <div class="spacer"></div>
      <a class="back" href="index.html"><i class="fa-solid fa-arrow-left"></i> Retour au site</a>
    </div>
  </header>

  <div class="wrap">
    <h1>Devis automatique</h1>
    <p class="muted">
      Entre tes infos de voyage. Je calcule une <b>estimation de prix public</b> pour la planification.<br>
      En ce moment : <b>offre lancement ‚Äî gratuit contre un avis</b> ‚≠ê
    </p>
    <div class="note"><i class="fa-solid fa-circle-info"></i> L‚Äôestimation d√©pend du budget total, de la dur√©e et du nombre de voyageurs.</div>

    <div class="panel">
      <h2 style="margin:0 0 8px">Demander un devis</h2>
      <p class="small" style="margin:0 0 12px">Remplis ce formulaire pour obtenir une estimation automatique. √Ä la fin, tu pourras m‚Äôenvoyer tes infos si tu veux aller plus loin.</p>

      <!-- ===== FORMULAIRE ===== -->
      <form id="quoteForm" novalidate>
        <div class="grid-2">
          <div>
            <label>Pr√©nom</label>
            <input name="firstname" required />
          </div>
          <div>
            <label>Email</label>
            <input type="email" name="email" required />
          </div>
        </div>

        <div>
          <label>Destination(s)</label>
          <input name="destinations" placeholder="ex. Japon, Cor√©e‚Ä¶" required />
        </div>

        <div class="grid-2">
          <div>
            <label>Date de d√©but</label>
            <input type="date" name="start" required />
          </div>
          <div>
            <label>Date de fin</label>
            <input type="date" name="end" required />
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label>Nombre de voyageurs</label>
            <input type="number" name="people" min="1" value="1" required />
          </div>
          <div>
            <label>Style de voyage</label>
            <select name="style">
              <option value="">Choisis‚Ä¶</option>
              <option>Aventure</option>
              <option>Culture</option>
              <option>Relax / baln√©aire</option>
              <option>Mix √©quilibr√©</option>
            </select>
          </div>
        </div>

        <div class="grid-2">
          <div>
            <label>Budget avion (par personne) ‚Ç¨</label>
            <input type="number" name="budget_flight" min="0" step="10" placeholder="ex. 800" />
          </div>
          <div>
            <label>Budget h√©bergement (total) ‚Ç¨</label>
            <input type="number" name="budget_hotel" min="0" step="10" placeholder="ex. 800" />
          </div>
        </div>

        <div>
          <label>Budget activit√©s & extras (total) ‚Ç¨</label>
          <input type="number" name="budget_activities" min="0" step="10" placeholder="ex. 500" />
        </div>

        <div class="grid-2">
          <div>
            <label>Complexit√©</label>
            <select name="complexity">
              <option value="normal">Classique (1‚Äì3 villes)</option>
              <option value="multi">Multi-villes (4+)</option>
              <option value="multi_countries">Multi-pays</option>
            </select>
          </div>
          <div>
            <label>Accompagnement</label>
            <select name="support">
              <option value="standard">Standard (pr√©paration)</option>
              <option value="plus">+ Rappels de r√©servations (HodoReminder)</option>
              <option value="premium">+ Dispo pendant le voyage</option>
            </select>
          </div>
        </div>

        <!-- Conditions + actions -->
        <div class="actions">
          <label class="tc">
            <input type="checkbox" id="agreeTC">
            <span>J‚Äôai lu et j‚Äôaccepte les <a href="conditions.html" target="_blank">Conditions de service</a>.</span>
          </label>

          <div style="flex:1"></div>

          <button type="button" class="btn primary" id="btnCalc">
            <i class="fa-solid fa-calculator"></i> Calculer l‚Äôestimation
          </button>
          <a class="btn ghost" href="index.html"><i class="fa-solid fa-arrow-left"></i> Retour</a>
        </div>
      </form>

      <!-- ===== R√âSULTAT ===== -->
      <div id="result" class="panel" style="display:none">
        <div class="row" style="justify-content:space-between; width:100%">
          <div>
            <div class="pill"><i class="fa-solid fa-receipt"></i> Estimation de prix public</div>
            <div class="est-total" id="estRange"></div>
            <div class="small" id="estExplain"></div>
          </div>
          <div style="text-align:right">
            <div class="ok"><i class="fa-solid fa-gift"></i> Offre lancement : <b>GRATUIT</b> ‚≠ê</div>
            <div class="small">contre un avis apr√®s r√©alisation</div>
          </div>
        </div>

        <div id="nextMsg" class="small" style="margin-top:12px"></div>

        <div class="row" style="margin-top:12px">
          <a id="btnDetails" class="btn ghost" href="#" target="_blank">
            <i class="fa-solid fa-list-check"></i> Formulaire d√©taill√©
          </a>
          <button class="btn primary" id="btnSend" disabled>
            <i class="fa-solid fa-paper-plane"></i> Envoyer ma demande
          </button>
        </div>
      </div>
    </div>
  </div>

<script>
  // ---------- Utils ----------
  const round10 = v => Math.round(v/10)*10;
  const daysBetween = (d1, d2) => {
    if(!d1 || !d2) return 0;
    const a = new Date(d1), b = new Date(d2);
    return Math.max(0, Math.round((b - a) / 86400000));
  };

  // Elements
  const form      = document.getElementById('quoteForm');
  const btnCalc   = document.getElementById('btnCalc');
  const result    = document.getElementById('result');
  const estRange  = document.getElementById('estRange');
  const estExplain= document.getElementById('estExplain');
  const agreeTC   = document.getElementById('agreeTC');
  const btnSend   = document.getElementById('btnSend');
  const btnDetails= document.getElementById('btnDetails');
  const nextMsg   = document.getElementById('nextMsg');

  // URL de ton formulaire d√©taill√©
  const DETAILED_FORM_URL = 'detail.html';

  // ---------- Calcul estimation ----------
  function computeQuote({flightPP=0, hotel=0, activities=0, people=1, days=0, complexity='normal', support='standard'}){
    const totalBudget = (flightPP||0) * (people||1) + (hotel||0) + (activities||0);

    // Pourcentages de base
    let pctLow=0.10, pctHigh=0.14;
    if (totalBudget < 1500){ pctLow=0.08; pctHigh=0.10; }
    else if (totalBudget <= 4000){ pctLow=0.10; pctHigh=0.14; }
    else if (totalBudget <= 8000){ pctLow=0.11; pctHigh=0.15; }
    else { pctLow=0.12; pctHigh=0.16; }

    // Ajustement dur√©e (>7j : +0.2%/j, max +2%)
    const extraDays = Math.max(0, (days||0) - 7);
    const durAdj = Math.min(0.02, extraDays * 0.002);
    pctLow += durAdj; pctHigh += durAdj;

    // Ajustements voyageurs / complexit√© / support
    if ((people||1) > 4){ pctLow += 0.01; pctHigh += 0.01; }
    if (complexity === 'multi'){ pctLow += 0.005; pctHigh += 0.01; }
    if (complexity === 'multi_countries'){ pctLow += 0.01; pctHigh += 0.02; }
    if (support === 'plus'){ pctLow += 0.005; pctHigh += 0.01; }
    if (support === 'premium'){ pctLow += 0.015; pctHigh += 0.025; }

    // Base fixe pour petits budgets
    const baseFee = totalBudget < 1500 ? 40 : 0;

    let estLow = baseFee + totalBudget * pctLow;
    let estHigh = baseFee + totalBudget * pctHigh;

    // Arrondi + bornes demand√©es 10‚Ç¨ / 400‚Ç¨
    estLow  = Math.max(10, round10(estLow));
    estHigh = Math.min(400, round10(estHigh));
    if (estLow > estHigh) estLow = Math.max(10, Math.min(estHigh, 20));

    return { totalBudget, estLow, estHigh, pctLow, pctHigh };
  }

  // ---------- Actions ----------
  btnCalc.addEventListener('click', () => {
    const data = new FormData(form);
    const start = data.get('start'), end = data.get('end');
    const days = daysBetween(start, end);
    const people = parseInt(data.get('people')||'1',10);

    const flightPP = parseFloat(data.get('budget_flight')||'0');
    const hotel = parseFloat(data.get('budget_hotel')||'0');
    const activities = parseFloat(data.get('budget_activities')||'0');
    const complexity = data.get('complexity')||'normal';
    const support = data.get('support')||'standard';

    // Si > 60 jours -> message "voyage tr√®s long"
    if (days > 60){
      estRange.textContent = 'Projet long (2+ mois)';
      estExplain.textContent = `Votre voyage dure ${days} jours. Pour un projet de cette ampleur, l‚Äôestimation automatique est d√©sactiv√©e.`;
      nextMsg.innerHTML = `üß≠ Ton voyage est tr√®s long : <b>compl√®te le formulaire d√©taill√©</b> avec un maximum d‚Äôinfos et je t‚Äôenverrai un devis pr√©cis au plus vite.`;
      const qs = new URLSearchParams(Object.fromEntries(data.entries())).toString();
      btnDetails.href = `${DETAILED_FORM_URL}?${qs}`;
      result.style.display = 'block';
      result.scrollIntoView({behavior:'smooth'});
      return;
    }

    const {estLow, estHigh, totalBudget, pctLow, pctHigh} = computeQuote({
      flightPP, hotel, activities, people, days, complexity, support
    });

    estRange.textContent = `${estLow.toLocaleString('fr-FR')}‚Ç¨ ‚Äì ${estHigh.toLocaleString('fr-FR')}‚Ç¨`;
    estExplain.textContent = `Bas√© sur un budget total ‚âà ${Math.round(totalBudget).toLocaleString('fr-FR')}‚Ç¨ (${(pctLow*100).toFixed(1)}‚Äì${(pctHigh*100).toFixed(1)}% + ajustements).`;
    nextMsg.innerHTML = `üëç Le prix te convient ? <b>Compl√®te ce formulaire plus pr√©cis</b> pour me donner un maximum de d√©tails (rythme, envies, contraintes). Je t‚Äôenverrai <b>le devis exact</b> au plus vite.`;

    // Lien formulaire d√©taill√© pr√©-rempli
    const qs = new URLSearchParams(Object.fromEntries(data.entries()));
    qs.set('estimation', `${estLow}-${estHigh}`);
    btnDetails.href = `${DETAILED_FORM_URL}?${qs.toString()}`;

    result.style.display = 'block';
    result.scrollIntoView({behavior:'smooth'});
  });

  // Activer l‚Äôenvoi uniquement si conditions coch√©es
  document.addEventListener('change', () => {
    btnSend.disabled = !agreeTC.checked;
  });

  // Envoi (√† brancher si besoin)
  btnSend.addEventListener('click', async (e) => {
    e.preventDefault();
    if(!agreeTC.checked){
      alert("Merci d‚Äôaccepter les conditions avant d‚Äôenvoyer.");
      return;
    }
    alert("Merci ! Ta demande a √©t√© envoy√©e. R√©ponse sous 24h ‚úàÔ∏è");
  });
</script>
</body>
</html>